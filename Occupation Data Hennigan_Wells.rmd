---
title: "Occupational Data"
author: "Mary Hennigan and Rob Wells and Abby Zimmardi" 
date: "3/1/2021"
output: pdf_document
---

# Mary- Abby:
# Please go through and do some serious cutting on this script

#From Hennigan: We did not finish this cleaning this week. The old chunks were cut out and poultry general time series created. Will finish cleaning next week, NICAR and Walmart reporting took over. 



# 1) Moved the whole occupational_master table construction to the end.
# Kill out any previous versions
# 2) Clean cities.
# 3) Clean counties.
# 4) Clean companies
# 5) Write an updated csv with the cleaned companies, cities and counties
# 6) Run totals by company, highest cases




# Compilation of Occupational COVID-19 Reports for Calculations

-**It will create a masterfile: occupational_master.csv**

# Part 1: Import Data, Clean It

```{r include=FALSE}
#install.packages("slider")
#install.packages("zoo")
#install.packages("gtools")
# vignette("basic-usage", package="googlesheets")
#install.packages("googledrive")
#install.packages("googlesheets4")
library(tidyverse)
library(janitor)
library(lubridate)
library(googlesheets4)
library(googledrive)
library(tidyr)
library(jsonlite)
library(gtools)
library(zoo)
library(reshape2)
library(slider)
```



#--------------------------------------------------------------------#
#--------------------------------------------------------------------#
#Part 1: CLEANING
#--------------------------------------------------------------------#
#--------------------------------------------------------------------#

#Import occupational_master from github. New version needs to be imported 

```{r}
occupational_master <- rio::import("https://raw.githubusercontent.com/profrobwells/Spring2021Data/main/occupational_master.csv")

```


#City Work
#Needs more cleaning. "AR" is not a city. Two reports from May have two cities listed in one cell. Six reports from October have part of the Industry type split between City and County column. "Various locations" is not a city. Springdale Public school is in Springdale City, Washington County. Need to remove punctuation, spaces


#USE THIS TEMPLATE TO CLEAN CITY NAMES
#hennigan needs to get rid of punctuation to further clean, then this part is finished and can be replicated to counties.
```{r}
#Thanks Sean, Kara and Nick:
cleaned_data <- occupational_master %>%
  mutate(cleaned_city = tolower(city)) %>%
  #mutate(cleaned_city = str_remove(" ",cleaned_city)) %>%
  mutate(cleaned_city = case_when(
    str_detect(cleaned_city, "pine") ~ "pine_bluff",
    str_detect(cleaned_city, "hot") ~ "hot_springs",
    str_detect(cleaned_city, "smith") ~ "fort_smith",
    str_detect(cleaned_city, "ash") ~ "ashdown",
    str_detect(cleaned_city, "faulkner") ~ "faulkner",
    str_detect(cleaned_city, "green") ~ "green_forest",
    TRUE ~ cleaned_city
  ))

cleaned_data$cleaned_city <- str_trim(cleaned_data$cleaned_city)
#cleaned_data$cleaned_city <- gsub("[[:space:]]", "", occupational_master$cleaned_city)

```

#Change this to the cleaned reports
```{r}
#Analyze records by city location
cityreports <- occupational_master %>% 
  select(date, city, county) %>% 
  group_by(city) %>% 
  count() %>% 
  arrange(desc(n))
  
occupational_master$city <- gsub("[[:space:]]", "", occupational_master$city)

cityreports

#write.csv(cityreports, "cityreports.csv")

#Notes: Springdale has most reports with 70, Russellville follows with 59 then Rogers, 58. 
```

#Clean Counties using the same methods as above
#County Work
#Needs more cleaning: Some early records have two cities in city and two counties in county. Three December reports have part of the Industry type in the county column


#Clean company names
```{r}
#Thanks Sean, Kara and Nick:
cleaned_data <- occupational_master %>%
  mutate(cleaned = tolower(company_name)) %>%
  #mutate(cleaned = str_remove("'",cleaned)) %>%
  mutate(cleaned = case_when(
    str_detect(cleaned, "roehm") ~ "roehm_america",
    str_detect(cleaned, "tyson") ~ "tyson",
    TRUE ~ cleaned
  ))
```

#Revised Look at the company names 
#add the function that produces percent of the whole
```{r}
cleaned_data %>% 
  count(cleaned) %>% 
  arrange(desc(n))
#TOTAL NUMBER OF ARK STATE HEATH DEPT REPORTS PER COMPANY SINCE MAY 19, 2020
#SIX OF TEN ARE POULTRY PROCESSING
#TYSON IS 36% OF ALL REPORTS
```

#NEXT: FILTER THIS TO THE SPECIFIC WORKPLACE AND THE HIGHEST VALUE OF CASES
#This yieled 11,472 total cases before cleaning of the city column
```{r}
companytotals <- cleaned_data %>% 
  select(company_name, cleaned, date, address, city, county, total_number_of_cases) %>% 
  group_by(cleaned, address, city,county) %>% 
  filter(total_number_of_cases == max(total_number_of_cases)) 

sum(companytotals$total_number_of_cases)
  
```



#--------------------------------------------------------------------#
#--------------------------------------------------------------------#
#Part 2: ANALYSIS
#--------------------------------------------------------------------#
#--------------------------------------------------------------------#



#WELLS NOTE: Two of the wealthiest counties in Arkansas have the highest number of occupational reports Benton, 95; Washington 83;
#Wells concerned about losing detail with Tyson Berry St. etc, check to make sure nothing is missing. 


```{r}
#Analyze records by county location
countyreports <- occupational_master %>% 
  select(date, city, county) %>% 
  group_by(county) %>% 
  count() %>% 
  arrange(desc(n))

countyreports

#apply the remove punctuation
occupational_master$county <- gsub("[[:space:]]", "", occupational_master$county)


#write.csv(countyreports, "countyreports.csv")

#Notes: Benton, 95; Washington 83; Pope 68;Craighead 56 are the top counties. This is not 100% cleaned yet, but nearly finished.
  
```


#TOTAL REPORTS BY CITY BY DAY
```{r}
#Analyze records by date and location

occupational_master %>% 
  select(date, company_name, city, county) %>% 
  group_by(date, city, county) %>% 
  count() %>% 
  arrange(desc(n))
  
```

#Continued Analysis
```{r}
#Analyze records by cleaned company name
companyreports <- occupational_master %>% 
  select(date, city, county, cleaned) %>% 
  group_by(cleaned) %>% 
  count() %>% 
  arrange(desc(n))
  
#write.csv(companyreports, "companyreports.csv")
companyreports

#Notes: Tyson, 250, ConAgra, 39, Simmons Foods, 39
```


```{r}
#Analyze records by industry
industryreports <- occupational_master %>% 
  select(date, city, county, company_name, industry) %>% 
  group_by(industry) %>% 
  count() %>% 
  arrange(desc(n))
#write.csv(industryreports, "industryreports.csv")
industryreports
  
#Notes: Largest industry category is NA with 459, from 5.19 to 9.14. These are when the reports were Poulty, Non-Poultry.
#Manufacturing has 326 records
```

#Split Dates for Analysis
```{r}
occupational_master$year <- year(occupational_master$date)
occupational_master$month <- month(occupational_master$date, label=TRUE)
#occupation_master1$week <- week(occupation_master1$date)
#occupation_master1$day <- day(occupation_master1$date)
#occupation_master1$weekday <- wday(occupation_master1$date, label=TRUE, abbr=FALSE)

occupational_master
```

#WELLS COMMENT: Let's do a ggplot graphic with this
#Group by Month
```{r}
month_counts <- occupational_master %>%
  select(date, city, county, company_name, industry, month) %>% 
  group_by(month) %>% 
  count() %>% 
  arrange(desc(n))
month_counts
write.csv(month_counts,"month_counts.csv")
#Notes: June, 147, July, 142, Dec, 110 and Aug, 109 are the top months and only months above 100.
```

#Zimmardi attempt at a ggplot graphic
```{r}
#install.packages("ggplot2")
library(ggplot2)
#ggplot(month_counts, aes(x=month, y=n))
ggplot(month_counts) + geom_point(aes(x=month, y=n, color=n)) + geom_smooth(aes(x=month, y=n, color=n))


#Zimmardi note: I have been looking up different codes, and I can't figure out how to change the label names and add a title. But this shows the number of records by month.
```
#Practicing Time Series
```{r}
butterballanalysis <- occupational_final %>% 
  select(company_name, cleaned, date, address, city, county, total_number_of_cases) %>% 
  filter(company_name == "Butterball") %>% 
  arrange(desc(total_number_of_cases))
butterball
write.csv(butterballanalysis, "butterballanalysis.csv")

```

```{r}
fritolayanalysis <- occupational_final %>% 
  select(company_name, cleaned, date, address, city, county, total_number_of_cases) %>% 
  filter(company_name == "Frito Lay") %>% 
  arrange(desc(total_number_of_cases))
fritolayanalysis
#write.csv(fritolayanalysis, "fritolayanalysis.csv")

```


```{r}
conagraanalysis <- occupational_final %>% 
  select(company_name, cleaned, date, address, city, county, total_number_of_cases) %>% 
  filter(company_name == "ConAgra") %>% 
  arrange(desc(total_number_of_cases))
conagraanalysis
#write.csv(conagraanalysis, "conagraanalysis.csv")

```




#------------------------------#
#---Poultry General Buidling---#
#------------------------------#

#Consdolidated Poultry Reports into one Google Sheet here https://docs.google.com/spreadsheets/d/1kdsxw4Ppcm-HMl7OcnBWgJUeWFE_QPUzCiaP7QbXNHQ/edit#gid=508262715 

#Start by pulling in each sheet
```{r}
pgeneral5_22 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral5.22")
pgeneral5_26 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral5.26")
pgeneral5_29 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral5.29")
pgeneral6_2 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral6.2")
pgeneral6_5 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral6.5")
pgeneral6_8 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral6.8")
pgeneral6_14 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral6.14")
pgeneral6_18 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral6.18")
pgeneral6_21 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral6.21")
pgeneral6_25 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral6.25")
pgeneral6_28 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral6.28")
pgeneral7_3 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral7.3")
pgeneral7_6 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral7.6")
pgeneral7_13 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral7.13")
pgeneral7_20 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral7.20")
pgeneral7_24 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral7.24")
pgeneral7_27 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral7.27")
pgeneral7_31 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral7.31")
pgeneral8_3 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral8.3")
pgeneral8_7 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral8.7")
pgeneral8_10 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral8.10")
pgeneral8_13 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral8.13")
pgeneral8_17 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral8.17")
pgeneral8_20 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral8.20")
pgeneral8_24 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral8.24")
pgeneral8_27 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral8.27")
pgeneral8_31 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral8.31")
pgeneral9_3 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral9.3")
pgeneral9_7 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral9.7")
pgeneral9_9 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral9.9")
pgeneral9_14 <- rio::import("Poultry General Sheets 5_22_2020-9_14_2020.xlsx", which = "PGeneral9.14")


```


#Clean and Normalize All Names
```{r include=FALSE}
pgeneral5_22 <- clean_names(pgeneral5_22)
pgeneral5_26 <- clean_names(pgeneral5_26)
pgeneral5_29 <- clean_names(pgeneral5_29)
pgeneral6_2 <- clean_names(pgeneral6_2)
pgeneral6_5 <- clean_names(pgeneral6_5)
pgeneral6_8 <- clean_names(pgeneral6_8)
pgeneral6_14 <- clean_names(pgeneral6_14)
pgeneral6_18 <- clean_names(pgeneral6_18)
pgeneral6_21 <- clean_names(pgeneral6_21)
pgeneral6_25 <- clean_names(pgeneral6_25)
pgeneral7_3 <- clean_names(pgeneral7_3)
pgeneral7_6 <- clean_names(pgeneral7_6)
pgeneral7_13 <- clean_names(pgeneral7_13)
pgeneral7_20 <- clean_names(pgeneral7_20)
pgeneral7_24 <- clean_names(pgeneral7_24)
pgeneral7_27 <- clean_names(pgeneral7_27)
pgeneral7_31 <- clean_names(pgeneral7_31)
pgeneral8_3 <- clean_names(pgeneral8_3)
pgeneral8_7 <- clean_names(pgeneral8_7)
pgeneral8_10 <- clean_names(pgeneral8_10)
pgeneral8_13 <- clean_names(pgeneral8_13)
pgeneral8_17 <- clean_names(pgeneral8_17)
pgeneral8_24 <- clean_names(pgeneral8_24)
pgeneral8_27 <- clean_names(pgeneral8_27)
pgeneral8_31 <- clean_names(pgeneral8_31)
pgeneral9_3 <- clean_names(pgeneral9_3)
pgeneral9_7 <- clean_names(pgeneral9_7)
pgeneral9_9 <- clean_names(pgeneral9_9)
pgeneral9_14 <- clean_names(pgeneral9_14)

```

#Combine files to create poultry general dataframe
#This df shows infected poultry workers by county of residence. 
```{r}
poultry_general <- smartbind(pgeneral5_29,
                             pgeneral6_2,
                                 pgeneral6_5,
                                 pgeneral6_8,
                                 pgeneral6_14,
                                 pgeneral6_18,
                                 pgeneral6_21,
                                 pgeneral6_25,
                                 pgeneral7_3,
                                 pgeneral7_6,
                                 pgeneral7_13,
                                 pgeneral7_20,
                                 pgeneral7_24,
                                 pgeneral7_27,
                                 pgeneral7_31,
                                 pgeneral8_3,
                                 pgeneral8_7,
                                 pgeneral8_10,
                                 pgeneral8_13,
                                 pgeneral8_17,
                                 pgeneral8_24,
                                 pgeneral8_27,
                                 pgeneral8_31,
                                 pgeneral9_3,
                                 pgeneral9_7,
                                 pgeneral9_9,
                                 pgeneral9_14)

glimpse(poultry_general)
write.csv(poultry_general, "poultry_general.csv")
```




#--------------------------------------------------------------------#
#--------------------------------------------------------------------#
#OLD: TABLE BUILDING FOR OCCUPATIONAL_MASTER.CSV
#--------------------------------------------------------------------#
#--------------------------------------------------------------------#

 
#We have two spreadsheets in Google that contain all occupational outbreak reports from May 19, 2020 - Feb. 22, 2021
#Occupationals from PDFs https://docs.google.com/spreadsheets/d/1R5dVT4QN586ANvAH1SJ7ye94Br5OtrZsAA2e4KlWn0o/edit#gid=1215399371 
#Leftovers https://docs.google.com/spreadsheets/d/1iuxIguTLVKhVBxAeIGg2enB5cmhDhTbOqWb6w7XHIzI/edit#gid=1206136585

#Start master file by pulling in individual sheets 
#23 reports from May 19 - August 7 
```{r include=FALSE}
occupation5_19 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 5.19")
occupation5_22 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 5.22")
occupation5_26 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 5.26")
occupation5_29 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 5.29")
occupation6_2 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.2") 
occupation6_5 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.5") 
occupation6_8 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.8") 
occupation6_14 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.14") 
occupation6_18 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.18") 
occupation6_21 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.21") 
occupation6_25 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.25")
occupation7_3 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.3")
occupation7_6 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.6")
occupation7_13 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.13")
occupation7_20 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.20")
occupation7_24 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.24")
occupation7_27 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.27")
occupation7_31 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.31")
occupation8_3 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.3")
occupation8_7 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.7")
occupation8_17 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.17")
occupation8_24 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.24")
occupation8_27 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.27")
occupation8_31 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.31")

```

#Pull in the rest of August that didn't fit into the sheet Occupationals from PDFs. 
#3 reports from the Leftovers file from Aug. 10, 13, 20
```{r}
occupation8_10 <- rio::import("Leftovers.xlsx",which = "Occupational 8.10")
occupation8_13 <- rio::import("Leftovers.xlsx",which = "Occupational 8.13")
occupation8_20 <- rio::import("Leftovers.xlsx",which = "Occupational 8.20")
```

#Continue pulling reports from Occupationals from PDFs.
#46 reports from Sept. 3, 2020 - Feb. 22, 2021
```{r}
occupation9_3 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.3")
occupation9_7 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.7")
occupation9_9 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.9")
occupation9_14 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.14")
occupation9_17 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.17")
occupation9_24 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.24")
occupation9_28 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.28")
occupation10_1 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.1")
occupation10_5 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.5")
occupation10_8 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.8")
occupation10_12 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.12")
occupation10_15 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.15")
occupation10_19 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.19")
occupation10_22 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.22")
occupation10_26 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.26")
occupation10_29 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.29")
occupation11_2 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.02")
occupation11_5 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.05")
occupation11_9 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.09")
occupation11_12 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.12")
occupation11_16 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.16")
occupation11_19 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.19")
occupation11_23 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.23")
occupation11_26 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.26")
occupation11_30 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.30")
occupation12_3 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.3")
occupation12_7 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.7")
occupation12_10 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.10")
occupation12_14 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.14")
occupation12_17 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.17")
occupation12_21 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.21")
occupation12_24 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.24")
occupation12_28 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.28")
occupation12_31 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.31")
occupation1_4 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.04")
occupation1_7 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.07")
occupation1_11 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.11")
occupation1_14 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.14")
occupation1_18 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.18")
occupation1_21 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.21")
occupation1_25 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.25")
occupation1_28 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.28")
occupation2_1 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.01")
occupation2_4 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.04")
occupation2_8 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.08")
occupation2_11 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.11")
occupation2_22 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.22")
```

#Add new dates here. They will pull from the Leftovers file. 
```{r}
#EDIT X with new date
#occupationalX <- rio::import("Leftovers.xlsx",which = "Occupational X")
```

#Clean and Normalize All Names
```{r include=FALSE}
occupation5_19 <- clean_names(occupation5_19)
occupation5_22 <- clean_names(occupation5_22)
occupation5_26 <- clean_names(occupation5_26)
occupation5_29 <- clean_names(occupation5_29)
occupation6_2 <- clean_names(occupation6_2)
occupation6_5 <- clean_names(occupation6_5)
occupation6_8 <- clean_names(occupation6_8)
occupation6_14 <- clean_names(occupation6_14)
occupation6_18 <- clean_names(occupation6_18)
occupation6_21 <- clean_names(occupation6_21)
occupation6_25 <- clean_names(occupation6_25)
occupation7_3 <- clean_names(occupation7_3)
occupation7_6 <- clean_names(occupation7_6)
occupation7_13 <- clean_names(occupation7_13)
occupation7_20 <- clean_names(occupation7_20)
occupation7_24 <- clean_names(occupation7_24)
occupation7_27 <- clean_names(occupation7_27)
occupation7_31 <- clean_names(occupation7_31)
occupation8_3 <- clean_names(occupation8_3)
occupation8_7 <- clean_names(occupation8_7)
occupation8_10 <- clean_names(occupation8_10)
occupation8_13 <- clean_names(occupation8_13)
occupation8_17 <- clean_names(occupation8_17)
occupation8_24 <- clean_names(occupation8_24)
occupation8_27 <- clean_names(occupation8_27)
occupation8_31 <- clean_names(occupation8_31)
occupation9_3 <- clean_names(occupation9_3)
occupation9_7 <- clean_names(occupation9_7)
occupation9_9 <- clean_names(occupation9_9)
occupation9_14 <- clean_names(occupation9_14)
occupation9_17 <- clean_names(occupation9_17)
occupation9_24 <- clean_names(occupation9_24)
occupation9_28 <- clean_names(occupation9_28)
occupation10_1 <- clean_names(occupation10_1)
occupation10_5 <- clean_names(occupation10_5)
occupation10_8 <- clean_names(occupation10_8)
occupation10_12 <- clean_names(occupation10_12)
occupation10_15 <- clean_names(occupation10_15)
occupation10_19 <- clean_names(occupation10_19)
occupation10_22 <- clean_names(occupation10_22)
occupation10_26 <- clean_names(occupation10_26)
occupation10_29 <- clean_names(occupation10_29)
occupation11_2 <- clean_names(occupation11_2)
occupation11_5 <- clean_names(occupation11_5)
occupation11_9 <- clean_names(occupation11_9)
occupation11_12 <- clean_names(occupation11_12)
occupation11_16 <- clean_names(occupation11_16)
occupation11_19 <- clean_names(occupation11_19)
occupation11_23 <- clean_names(occupation11_23)
occupation11_26 <- clean_names(occupation11_26)
occupation11_30 <- clean_names(occupation11_30)
occupation12_3 <- clean_names(occupation12_3)
occupation12_7 <- clean_names(occupation12_7)
occupation12_10 <- clean_names(occupation12_10)
occupation12_14 <- clean_names(occupation12_14)
occupation12_17 <- clean_names(occupation12_17)
occupation12_21 <- clean_names(occupation12_21)
occupation12_24 <- clean_names(occupation12_24)
occupation12_28 <- clean_names(occupation12_28)
occupation12_31 <- clean_names(occupation12_31)
occupation1_4 <- clean_names(occupation1_4)
occupation1_7 <- clean_names(occupation1_7)
occupation1_11 <- clean_names(occupation1_11)
occupation1_14 <- clean_names(occupation1_14)
occupation1_18 <- clean_names(occupation1_18)
occupation1_21 <- clean_names(occupation1_21)
occupation1_25 <- clean_names(occupation1_25)
occupation1_28 <- clean_names(occupation1_28)
occupation2_1 <- clean_names(occupation2_1)
occupation2_4 <- clean_names(occupation2_4)
occupation2_8 <- clean_names(occupation2_8)
occupation2_11 <- clean_names(occupation2_11)
occupation2_22 <- clean_names(occupation2_22)

#add the most recent dates here
```

#Cleaning prior to Combination
#May 19 File renaming
```{r}
occupation5_19 <- occupation5_19 %>% 
  rename(company_name = "business_name",
         city = "location")
occupation5_19

```

#Rename files with column "employer, total_cases, number_closed_cases"
#May 22, 26
```{r}
occupation5_22 <- occupation5_22 %>% 
  rename(company_name = "employer",
         total_number_of_cases = "total_cases",
         number_recovered_cases = "number_closed_cases")
#occupation5_22

occupation5_26 <- occupation5_26 %>% 
  rename(company_name = "employer",
         total_number_of_cases = "total_cases",
         number_recovered_cases = "number_closed_cases")
#occupation5_26
```

#Rename files with employer_city_county column
#Dates May 29, 2020 - Sept. 14, 2020
```{r}
employer_column <- smartbind(occupation5_29,
                             occupation6_2,
                                 occupation6_5,
                                 occupation6_8,
                                 occupation6_14,
                                 occupation6_18,
                                 occupation6_21,
                                 occupation6_25,
                                 occupation7_3,
                                 occupation7_6,
                                 occupation7_13,
                                 occupation7_20,
                                 occupation7_24,
                                 occupation7_27,
                                 occupation7_31,
                                 occupation8_3,
                                 occupation8_7,
                                 occupation8_10,
                                 occupation8_13,
                                 occupation8_17,
                                 occupation8_24,
                                 occupation8_27,
                                 occupation8_31,
                                 occupation9_3,
                                 occupation9_7,
                                 occupation9_9,
                                 occupation9_14)


#Separate the fields to industry, city, county
employer_column <- separate(data = employer_column, col = employer_city_county, into = c("company_name", "city", "county"), sep = ",", extra = "merge", fill = "right")

glimpse(employer_column)
```

#Rename files with industry_city_county column
#Dates Sept. 17, 2020 - Present
```{r}
industry_column <- smartbind(occupation9_17,
                                 occupation9_24,
                                 occupation9_28,
                                 occupation10_1,
                                 occupation10_5,
                                 occupation10_8,
                                 occupation10_12,
                                 occupation10_15,
                                 occupation10_19,
                                 occupation10_22,
                                 occupation10_26,
                                 occupation10_29,
                                 occupation11_2,
                                 occupation11_5,
                                 occupation11_9,
                                 occupation11_12,
                                 occupation11_16,
                                 occupation11_19,
                                 occupation11_23,
                                 occupation11_26,
                                 occupation11_30,
                                 occupation12_3,
                                 occupation12_7,
                                 occupation12_10,
                                 occupation12_14,
                                 occupation12_17,
                                 occupation12_21,
                                 occupation12_24,
                                 occupation12_28,
                                 occupation12_31,
                                 occupation1_4,
                                 occupation1_7,
                                 occupation1_11,
                                 occupation1_14,
                                 occupation1_18,
                                 occupation1_21,
                                 occupation1_25,
                                 occupation1_28,
                                 occupation2_1,
                                 occupation2_4,
                                 occupation2_8,
                                 occupation2_11,
                                 occupation2_22)


#Separate the fields to industry, city, county
industry_column <- separate(data = industry_column, col = industry_city_county, into = c("industry", "city", "county"), sep = ",", extra = "merge", fill = "right")

glimpse(industry_column)
```

#Combine May 19, 2020 - Feb. 22, 2021
#Recreating occupational_master

#Has 814 observations. Our previous master had 1004. We have removed all of the poultry general rows.

#WELLS NOTE Collect the poultry in a separate dataframe
```{r warning=FALSE}
occupational_master <- smartbind(occupation5_19,
                                 occupation5_22,
                                 occupation5_26,
                                 employer_column,
                                 industry_column)
glimpse(occupational_master)

write.csv(occupational_master, "occupational_master.csv")

```




